title: 'Diffusers TTI'
author: 'ParisNeo'
version: 1.1.0
binding_name: 'diffusers'
supported_file_types: []

description: |
  This binding integrates Hugging Face's Diffusers library into LoLLMS
  for Text-to-Image (TTI) and Image-to-Image (ITI) tasks.

  It supports a wide range of diffusion-based models, including:
    - Stable Diffusion & SDXL (e.g. https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0)
    - Stable Diffusion 3 and SD3 variants (e.g. https://huggingface.co/stabilityai/stable-diffusion-3-medium-diffusers)
    - FLUX-style models (e.g. https://huggingface.co/black-forest-labs/FLUX.1-dev)
    - Qwen-based vision or diffusion models where compatible (e.g. https://huggingface.co/Qwen)
    - Community models such as RealVis, DreamShaper, Juggernaut, etc. from the Hugging Face Hub.

  Any compatible Diffusers or .safetensors pipeline can be installed via
  the provided management commands, and only locally downloaded models
  will appear in the binding's model list.

  Two main operations are supported:

  1. generate_image:
     - Generates one or multiple images from a text prompt.
     - Supports configuration of model, size, guidance scale, inference steps, scheduler, etc.

  2. edit_image (image-to-image / inpainting):
     - Modifies an existing image based on a prompt and optional mask.
     - Useful for inpainting, outpainting, or style transformation.

  Parameters can be set globally at initialization (e.g., default model, steps, scheduler),
  or per-request at runtime. Runtime overrides global, which overrides defaults.

input_parameters:
  - name: "port"
    type: "int"
    default: 9632
    description: "The port number on which the dedicated Diffusers server will run."

  - name: "extra_models_path"
    type: "str"
    default: ""
    description: "An optional path to an extra folder containing personalized models (.safetensors files)."

  - name: "hf_token"
    type: "str"
    default: ""
    description: "Optional Hugging Face access token used by the Diffusers server to download private or gated models."
    is_secret: true

  - name: "device"
    type: "str"
    default: "cuda"
    description: "Device to run the model on (e.g., 'cuda', 'mps', 'cpu')."

  - name: "dtype"
    type: "str"
    default: "float16"
    description: "Torch dtype to use for inference ('float16' recommended for GPU)."

  - name: "seed"
    type: "int"
    default: 42
    description: "Random seed for reproducibility."

  - name: "scheduler_name"
    type: "str"
    default: "dpm++_2m_karras"
    description: "Default scheduler to use for denoising steps. Can be overridden per generation."
    options: ["default", "ddim", "ddpm", "deis_multistep", "dpm_multistep", "dpm_multistep_karras", "dpm_single", "dpm_adaptive", "dpm++_2m", "dpm++_2m_karras", "dpm++_2s_ancestral", "dpm++_2s_ancestral_karras", "dpm++_sde", "dpm++_sde_karras", "euler_ancestral_discrete", "euler_discrete", "heun_discrete", "heun_karras", "lms_discrete", "lms_karras", "pndm", "unipc_multistep", "dpm++_2m_sde", "dpm++_2m_sde_karras", "dpm2", "dpm2_karras", "dpm2_a", "dpm2_a_karras", "euler", "euler_a", "heun", "lms"]

  - name: "num_inference_steps"
    type: "int"
    default: 30
    description: "Number of denoising steps (more steps = higher quality, slower)."

  - name: "guidance_scale"
    type: "float"
    default: 7.5
    description: "Classifier-free guidance scale. Higher = more prompt adherence."

  - name: "negative_prompt"
    type: "str"
    default: ""
    description: "Optional negative prompt to avoid unwanted features."

  - name: "width"
    type: "int"
    default: "1024"
    description: "Image width."

  - name: "height"
    type: "int"
    default: "1024"
    description: "Image height."

commands:
  - name: pull_model
    title: Pull Model
    description: "Downloads a model from Hugging Face (repo_id) or a direct URL to a safetensors file."
    parameters:
      - name: model_name
        type: str
        description: "The Hugging Face repo ID (e.g. 'stabilityai/sdxl-turbo') or URL."
        mandatory: true
      - name: local_name
        type: str
        description: "Optional custom name for the model folder or file."
        mandatory: false
    output:
      - name: status
        type: bool
        description: "Status of the operation (true for success, false for failure)"
      - name: message
        type: str
        description: "Message describing the operation result"
    callback:
      - name: status
        type: str
        description: "Current status of the download"
      - name: completed
        type: int
        description: "Bytes or percentage downloaded"
      - name: total
        type: int
        description: "Total bytes or percentage"

  - name: upgrade_diffusers
    title: Upgrade Diffusers
    description: "Upgrades the diffusers library to the latest development version."
    parameters: []
    output:
      - name: status
        type: bool
        description: "Status of the operation"
      - name: message
        type: str
        description: "Result message"
    callback:
      - name: status
        type: str
        description: "Status of the upgrade process"
